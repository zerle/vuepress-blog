<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS常用设计模式 | 张垒的博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="记录好的技术文档">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.3d11a1f1.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.cfe4f1dc.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/7.a84a24ff.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.c3a99807.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/1.c178cf32.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/55.84021d4c.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.7e8e7b1e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.52366231.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.8efccace.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.acd8f527.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.696abc55.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.83830d6d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.02b980f1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.68f440c9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.0a9cda66.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.7edb07fe.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.f567e8c0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.2884f722.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.d348a5d9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.ec080050.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.69adbacd.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.e94edaee.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.fa2c3683.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.480e11e4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.83b8031d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.9e44a369.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.ab5be7a3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.fd74f8d8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.cf91586c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.57e43fc1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.f12bb5f8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.0505d053.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.128579b6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.afd14854.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.136c8139.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.d9f667de.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.4702d49e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.c2c28470.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.2fc7c472.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.9b307549.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.ef443176.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.a7c60c22.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.466967ef.js"><link rel="prefetch" href="/vuepress-blog/assets/js/47.48816b2e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.cbbfa44c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/49.b362bf6d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.3df9e6ac.js"><link rel="prefetch" href="/vuepress-blog/assets/js/50.7605d1cc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/51.35192135.js"><link rel="prefetch" href="/vuepress-blog/assets/js/52.bf567756.js"><link rel="prefetch" href="/vuepress-blog/assets/js/53.b0768c7b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/54.9735e1f7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/56.e4771e7e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/57.7c72619d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/58.f8487d5b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/59.c97f0f0e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.5940db39.js"><link rel="prefetch" href="/vuepress-blog/assets/js/60.0cb291f7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/61.2405fff4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/62.a854dc11.js"><link rel="prefetch" href="/vuepress-blog/assets/js/63.13eb262f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/64.cb4d6ac7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/65.6e7515c4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/66.7db29015.js"><link rel="prefetch" href="/vuepress-blog/assets/js/67.45bf8f7c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/68.b604b4f6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/69.8e28194e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/70.6c3a479b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/71.b1ddb05f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.f2a8d12d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.0b4a9f34.js"><link rel="prefetch" href="/vuepress-blog/assets/js/vendors~docsearch.5bf76089.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.3d11a1f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>张垒的博客</h3> <p class="description" data-v-59e6cb88>记录好的技术文档</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">张垒的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/刷题/" class="nav-link"><i class="undefined"></i>
  刷题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      zhang lei 的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/4495277269197975" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/zerle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/vuepress-blog/me.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>33</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>31</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/工具/" class="nav-link"><i class="undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/刷题/" class="nav-link"><i class="undefined"></i>
  刷题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      zhang lei 的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/4495277269197975" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/zerle" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>JS常用设计模式</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">JS常用设计模式</h1> <div data-v-8a445198><!----> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2021/2/28</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>JavaScript设计模式</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-单例模式"><a href="#_1-单例模式" class="header-anchor">#</a> 1.单例模式</h2> <h3 id="普通单例模式"><a href="#普通单例模式" class="header-anchor">#</a> 普通单例模式</h3> <p>“单例模式” 就是通过类创建实例后，每次创建和获取都返回同一个实例，下面是 “单例模式” 最基本的实现。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* ES6 写法 */
class Person <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  static getInstance<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this.instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.instance <span class="token operator">=</span> new Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> this.instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const w1 <span class="token operator">=</span> Person.getInstance<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const w2 <span class="token operator">=</span> Person.getInstance<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>w1 <span class="token operator">==</span><span class="token operator">=</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* ES5 写法 */
<span class="token keyword">function</span> Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Person.getInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> instance<span class="token punctuation">;</span>
  <span class="token builtin class-name">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      instance <span class="token operator">=</span> new Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const w1 <span class="token operator">=</span> Person.getInstance<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const w2 <span class="token operator">=</span> Person.getInstance<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>w1 <span class="token operator">==</span><span class="token operator">=</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
</code></pre></div><p>上面分别用 ES6 和 ES5 的方式实现了一个基本的单例模式，创建 Person 的实例时需要通过 getInstance 静态方法，这样第一次会创建一个实例，再次调用时会将之前创建的实例返回，达到单例的目的。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>上面单例模式的缺点：

* 类的使用者必须要知道这是一个单例的类，创建和获取实例必须通过调用 getInstance 方法；
* 并不能真正阻止类的使用者通过 new 关键字创建出新的实例。
</code></pre></div><h3 id="透明单例模式"><a href="#透明单例模式" class="header-anchor">#</a> 透明单例模式</h3> <p>“透明单例模式” 可以解决上面普通 “单例模式” 的不足，希望可以直接使用 new 关键字来创建类的实例，如果已经创建，再次通过 new 创建，则会返回之前创建的实例。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 透明单例模式 */
const Person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> instance<span class="token punctuation">;</span>

  <span class="token builtin class-name">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      instance <span class="token operator">=</span> this<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const w1 <span class="token operator">=</span> new Person<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const w2 <span class="token operator">=</span> new Person<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>w1 <span class="token operator">==</span><span class="token operator">=</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
</code></pre></div><p>“透明单例模式” 的原理是创建一个自执行函数，内部创建一个私有变量 instance 用来存储创建的实例，并通过闭包返回一个构造函数，用变量 Person 接收，当使用 new 创建实例时，先检测私有变量 instance 是否有值，如果没值则创建实例，如果有值则直接返回 instance（利用 new 关键字和构造创建实例的原理实现）。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>缺点：违反了单一职责原则（一个函数只做一件事），自执行函数返回的构造函数已经不止单纯用作构建实例，同时处理了单例的判断逻辑。
</code></pre></div><h3 id="单例与构建分离"><a href="#单例与构建分离" class="header-anchor">#</a> 单例与构建分离</h3> <p>针对上面 “透明单例模式” 的缺点，下面将构造函数单例处理与构建逻辑进行分离。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 单例逻辑与构建逻辑分离 */
// 真正的构造函数
<span class="token keyword">function</span> Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Person.prototype.getName <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>this.name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 新的构造函数
const CreatePerson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> instance<span class="token punctuation">;</span>

  <span class="token builtin class-name">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      instance <span class="token operator">=</span> new Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const w1 <span class="token operator">=</span> new CreatePerson<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const w2 <span class="token operator">=</span> new CreatePerson<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>w1 <span class="token operator">==</span><span class="token operator">=</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
</code></pre></div><p>上面代码将单例的逻辑与构造函数的逻辑进行了分离，真正用于构造实例的类是 Person，用于处理单例逻辑的是自执行函数返回的函数，使用 CreatePerson 变量接收，这个函数也同时约定好被当做构造函数使用（通过 new 关键字调用和直接执行效果相同）。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>缺点：生成的新构造函数名字（CreatePerson）是固定的，用来创建实例的这个类（Person）也是固定的，不够灵活。
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 封装变化 */
const CreateSingle <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Constructor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> instance<span class="token punctuation">;</span>

  const SingleConstructor <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Constructor.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      instance <span class="token operator">=</span> this<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  // 实现原型继承
  SingleConstructor.prototype <span class="token operator">=</span> Object.create<span class="token punctuation">(</span>Constructor.prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">return</span> SingleConstructor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 使用方式 */
// 构造函数
<span class="token keyword">function</span> Person<span class="token punctuation">(</span>name, age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  this.age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> Dailog<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  this.name <span class="token operator">=</span> name
<span class="token punctuation">}</span>

// 原型方法
Person.prototype.sayHi <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>this.name + <span class="token string">'：'</span> + this.age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Dailog.prototype.getName <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>this.name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 创建新的构造函数并生成实例
const CreatePerson <span class="token operator">=</span> CreateSingle<span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span>
const w1 <span class="token operator">=</span> new CreatePerson<span class="token punctuation">(</span><span class="token string">'hello'</span>, <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const w2 <span class="token operator">=</span> new CreatePerson<span class="token punctuation">(</span><span class="token string">'world'</span>, <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const CreateDailog <span class="token operator">=</span> CreateSingle<span class="token punctuation">(</span>Dailog<span class="token punctuation">)</span><span class="token punctuation">;</span>
const s1 <span class="token operator">=</span> new CreateDailog<span class="token punctuation">(</span><span class="token string">'model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const s2 <span class="token operator">=</span> new CreateDailog<span class="token punctuation">(</span><span class="token string">'view'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>w1 <span class="token operator">==</span><span class="token operator">=</span> w2<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
console.log<span class="token punctuation">(</span>s1 <span class="token operator">==</span><span class="token operator">=</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
</code></pre></div><p>上面我们把创建单例的逻辑进行了封装变成了一个通用的逻辑，对于不同构造函数所创建实例，只需要传入这个构造函数并生成新的构造函数，需要注意的是，新的构造函数无法继承原构造函数的原型方法，所以通过继承实现的。</p> <h3 id="单例模式的应用"><a href="#单例模式的应用" class="header-anchor">#</a> 单例模式的应用</h3> <h4 id="命名空间"><a href="#命名空间" class="header-anchor">#</a> 命名空间</h4> <p>在编写代码时，我们有时候需要人为的创建命名空间，以防止变量的相互污染，这是可以使用 “单例模式” 来实现。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 创建命名空间的方法 */
// 存储工具方法
const utils <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

// 定义命名空间
utils.define <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>namespace, fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  // 获取命名空间的数组
  const namespaces <span class="token operator">=</span> namespace.split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  // 最后一项为设定方法的属性名
  const methodName <span class="token operator">=</span> namespaces.pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  // 定义变量存储当前命名空间的引用，默认为 utils（根命名空间）
  <span class="token builtin class-name">let</span> current <span class="token operator">=</span> utils<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> namespaces.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const currentNamespace <span class="token operator">=</span> namespaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    // 当某一个命名空间没有时，则创建这个命名空间（单例模式）
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>current<span class="token punctuation">[</span>currentNamespace<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token punctuation">[</span>currentNamespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    // 否则让当前命名空间指向已有的命名空间
    current <span class="token operator">=</span> current<span class="token punctuation">[</span>currentNamespace<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  // 将传入的函数设定给最后一级命名空间的属性上
  current<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 命名空间的创建和使用 */
// 通过命名空间定义方法
utils.define<span class="token punctuation">(</span><span class="token string">'dom.class.addClass'</span>, <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'dom.class.addClass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

utils.define<span class="token punctuation">(</span><span class="token string">'string.trim'</span>, <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'string.trim'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

utils.define<span class="token punctuation">(</span><span class="token string">'event.prevent'</span>, <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'event.prevent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 使用方法
utils.dom.class.addClass<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // dom.class.addClass
utils.string.trim<span class="token punctuation">(</span><span class="token string">' hello '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // string.trim
utils.event.prevent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // event.prevent
</code></pre></div><p>上面代码的设计希望通过 utils 对象的 define 方法按照传入的表示命名空间的字符串去创建方法，基本实现思路和逻辑是，当一个属性是第一次出现时，创建一个对象作为该命名空间，当再次出现时则不会重复创建命名空间（因为会出现覆盖的问题），而是沿用之前创建的命名空间。</p> <h3 id="lru-缓存"><a href="#lru-缓存" class="header-anchor">#</a> LRU 缓存</h3> <p>LRU 全称为 Least Recently Used，为最近使用的意思，缓存的方式为访问一个元素时，则将其标记为活跃，当存储时，如果超出容量则删除最不常用的元素。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 创建 LRU 缓存类 */
class LRUCache <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span>
    this.members <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  put<span class="token punctuation">(</span>key, val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">let</span> oldestIndex <span class="token operator">=</span> -1<span class="token punctuation">;</span> // 最不活跃项的索引
    <span class="token builtin class-name">let</span> oldestAge <span class="token operator">=</span> -1<span class="token punctuation">;</span> // 最不活跃项的活跃数值
    <span class="token builtin class-name">let</span> found <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> this.members.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      const member <span class="token operator">=</span> this.members<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

      // 如果找到当前最不活跃的项，将 oldestAge 和 oldestIndex 更新为该项对应值
      <span class="token keyword">if</span> <span class="token punctuation">(</span>member.age <span class="token operator">&gt;</span> oldestAge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        oldestAge <span class="token operator">=</span> member.age<span class="token punctuation">;</span>
        oldestIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      // 如果添加项在原本 members 中已经存在，则更新 age 的值为 <span class="token number">0</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>member.key <span class="token operator">==</span><span class="token operator">=</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this.members<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> key, val, age: <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        found <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> // 为了跳过 push 新增的环节
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        // 否则其他所有项 age 自增
        member.age++<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>found<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>this.members.length <span class="token operator">&gt;=</span> this.capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this.members.splice<span class="token punctuation">(</span>oldestIndex, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      this.members.push<span class="token punctuation">(</span><span class="token punctuation">{</span> key, val, age: <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  get<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> this.members.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      const member <span class="token operator">=</span> this.members<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>member.key <span class="token operator">==</span><span class="token operator">=</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        member.age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> member.val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> -1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面是一个创建 LRU 缓存的类，用数组管理成员，put 方法用于新增成员，get 方法用于访问成员，当访问成员时，成员的 age 清零，代表最近活跃，当新增元素时，如果该元素已存在，则做覆盖操作，如果不存在，则推入数组中，age 设置为零，其他成员 age 自增，若数组超出容量时，先找到 age 最大的元素删除，再将新的元素推入数组，上面是一个直观但性能较差的实现，如果有兴趣可以使用链表进行优化。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 使用 LRU 缓存 */
const cache <span class="token operator">=</span> new LRUCache<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache.put<span class="token punctuation">(</span><span class="token string">'1'</span>, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>cache.members<span class="token punctuation">)</span><span class="token punctuation">;</span>
// <span class="token punctuation">[</span> <span class="token punctuation">{</span> key: <span class="token string">'1'</span>, val: <span class="token number">1</span>, age: <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>

cache.put<span class="token punctuation">(</span><span class="token string">'2'</span>, <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>cache.members<span class="token punctuation">)</span><span class="token punctuation">;</span>
// <span class="token punctuation">[</span> <span class="token punctuation">{</span> key: <span class="token string">'1'</span>, val: <span class="token number">1</span>, age: <span class="token number">1</span> <span class="token punctuation">}</span>, <span class="token punctuation">{</span> key: <span class="token string">'2'</span>, val: <span class="token number">2</span>, age: <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>

cache.put<span class="token punctuation">(</span><span class="token string">'3'</span>, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>cache.members<span class="token punctuation">)</span><span class="token punctuation">;</span>
// <span class="token punctuation">[</span> <span class="token punctuation">{</span> key: <span class="token string">'2'</span>, val: <span class="token number">2</span>, age: <span class="token number">1</span> <span class="token punctuation">}</span>, <span class="token punctuation">{</span> key: <span class="token string">'3'</span>, val: <span class="token number">3</span>, age: <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>

cache.put<span class="token punctuation">(</span><span class="token string">'2'</span>, <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>cache.members<span class="token punctuation">)</span><span class="token punctuation">;</span>
// <span class="token punctuation">[</span> <span class="token punctuation">{</span> key: <span class="token string">'2'</span>, val: <span class="token string">'hello'</span>, age: <span class="token number">0</span> <span class="token punctuation">}</span>, <span class="token punctuation">{</span> key: <span class="token string">'3'</span>, val: <span class="token number">3</span>, age: <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>“单例模式” 是设计模式中非常好理解的一个，使用还是非常广泛的，在 Redux 等众多的第三方库中也有所体现.</p> <h2 id="_2-发布-订阅和观察者模式"><a href="#_2-发布-订阅和观察者模式" class="header-anchor">#</a> 2.发布/订阅和观察者模式</h2> <h3 id="发布-订阅模式"><a href="#发布-订阅模式" class="header-anchor">#</a> 发布/订阅模式</h3> <p>发布/订阅模式实现</p> <p>在说 “观察者模式” 之前一定要说一下 “发布/订阅模式”，因为这两个模式非常相似又有些不同，最重要的是在设计模式中使用频繁。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 发布/订阅的类 */
class Event <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  on<span class="token punctuation">(</span>type, fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>this.events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>this.events<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">))</span>.push<span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  emit<span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>this.events<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.events<span class="token punctuation">[</span>type<span class="token punctuation">]</span>.forEach<span class="token punctuation">(</span>fn <span class="token operator">=</span><span class="token operator">&gt;</span> fn<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的类有一个基本属性 events，值为对象，用来存储不同类型的事件集合，原型方法 on 是用来订阅事件，第一个参数 type 为订阅事件的类型，fn 是要被执行的事件，emit 方法用来执行某个类型所有的事件。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 发布/订阅的使用 */
const event <span class="token operator">=</span> new Event<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 订阅事件
event.on<span class="token punctuation">(</span><span class="token string">'say'</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
event.on<span class="token punctuation">(</span><span class="token string">'say'</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

// 发布事件
event.emit<span class="token punctuation">(</span><span class="token string">'say'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// hello
// world
</code></pre></div><h4 id="发布-订阅模式的应用"><a href="#发布-订阅模式的应用" class="header-anchor">#</a> 发布/订阅模式的应用</h4> <h5 id="浏览器事件监听"><a href="#浏览器事件监听" class="header-anchor">#</a> 浏览器事件监听：</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span>button <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>click<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  const btn <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  btn.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  btn.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  btn.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>当点击按钮触发事件时，三个回调函数会按照添加的顺序依次执行。</p> <p>Promise 的异步调用的回调管理：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>const promise <span class="token operator">=</span> new Promise<span class="token variable"><span class="token punctuation">((</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> {
  setTimeout<span class="token punctuation">((</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> resolve<span class="token punctuation">(</span>'res'<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
}<span class="token punctuation">)</span><span class="token punctuation">;</span>

promise.then<span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">))</span></span><span class="token punctuation">;</span>
promise.then<span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token number">2</span>, data<span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre></div><p>上面给同一个 Promise 实例的 then 方法中添加了两个回调函数，因为在创建 Promise 实例时内部使用了定时器，所以状态的变化延后了 3s，其实在 Promise 内部也是通过队列来对 then 的回调进行统一管理，在状态发生变化后立即循环执行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>在 Node.js 中，有一个核心模块 events 提供的类 EventEmitter，几乎所有的事件都是基于这个模块实现的，如流的 data 和 end 事件、http 的 request 事件，而 EventEmitter 的内部原理就是 “发布/订阅模式”。
</code></pre></div><h3 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h3> <h4 id="观察者模式的简单实现"><a href="#观察者模式的简单实现" class="header-anchor">#</a> 观察者模式的简单实现</h4> <p>下面我们是 “观察者模式” 的案例，通过上面 “发布/订阅模式” 的实现来对比一下异同。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 观察者模式 */
// 被观察者类
class Star <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    this.state <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    this.observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  setState<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    this.notify<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 更新状态后通知
  <span class="token punctuation">}</span>
  attach<span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.observers.push<span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span> // 添加观察者
  <span class="token punctuation">}</span>
  <span class="token function-name function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    // 订阅状态的观察者更新修改后的状态
    this.observers.forEach<span class="token punctuation">(</span>observer <span class="token operator">=</span><span class="token operator">&gt;</span> observer.update<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 观察者类
class Fan <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name, star<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    this.star <span class="token operator">=</span> star<span class="token punctuation">;</span>
    this.star.attach<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'我喜欢的明星喜欢'</span> + this.star.getState<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token string">'，我也喜欢。'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 “观察者模式” 中有两个基本的类，观察者和被观察者，被观察者提供状态 state，观察者去使用这个状态，当被观察者更新状态时会主动发布到订阅了状态的观察中，实现同步更新。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>const star <span class="token operator">=</span> new Star<span class="token punctuation">(</span><span class="token string">'Super Star'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const fan <span class="token operator">=</span> new Fan<span class="token punctuation">(</span><span class="token string">'张三'</span>, star<span class="token punctuation">)</span><span class="token punctuation">;</span>

star.setState<span class="token punctuation">(</span><span class="token string">'绿色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 我喜欢的明星喜欢绿色，我也喜欢。
</code></pre></div><h4 id="观察者模式的应用"><a href="#观察者模式的应用" class="header-anchor">#</a> 观察者模式的应用</h4> <p>Vue 框架的数据响应式原理及 watch 方法：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>FullName: <span class="token punctuation">{</span><span class="token punctuation">{</span>fullName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
    FirstName:
    <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v-model<span class="token operator">=</span><span class="token string">&quot;firstName&quot;</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
    LastName:
    <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v-model<span class="token operator">=</span><span class="token string">&quot;lastName&quot;</span> /<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/vue&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  new Vue<span class="token punctuation">(</span><span class="token punctuation">{</span>
    el: <span class="token string">'#root'</span>,
    data: <span class="token punctuation">{</span>
      firstName: <span class="token string">'张'</span>,
      lastName: <span class="token string">'三'</span>,
      fullName: <span class="token string">'张三'</span>
    <span class="token punctuation">}</span>,
    watch: <span class="token punctuation">{</span>
      firstName<span class="token punctuation">(</span>newName, oldName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this.fullName <span class="token operator">=</span> newName + this.lastName<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>在 Vue 2.x 版本的数据响应式和 watch 监听的底层，就使用了 “观察者模式”，在模板解析过程中为变量添加观察者（watcher），在使用 Object.defineProperty 的 getter 和 setter 进行劫持数据，数据获取和更改会触发 get 和 set 方法，进而执行订阅和通知的逻辑，而通知的过程中调用了被统一管理的观察者的 update 方法，实现了视图层与数据层的同步。</p> <p>redux 的 createStore 方法：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">function</span> createStore<span class="token punctuation">(</span>reducer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> state<span class="token punctuation">;</span>
  <span class="token builtin class-name">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  // 获取 store
  const getState <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> JSON.parse<span class="token punctuation">(</span>JSON.stringify<span class="token punctuation">(</span>state<span class="token punctuation">))</span><span class="token punctuation">;</span>

  // 订阅方法
  const subscribe <span class="token operator">=</span> fn <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    listeners.push<span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 取消订阅方法
    <span class="token builtin class-name">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      listeners <span class="token operator">=</span> listeners.filter<span class="token punctuation">(</span>listener <span class="token operator">=</span><span class="token operator">&gt;</span> listener <span class="token operator">!=</span><span class="token operator">=</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  // 派发动作
  const dispatch <span class="token operator">=</span> action <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> reducer<span class="token punctuation">(</span>state, action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listeners.forEach<span class="token punctuation">(</span>listener <span class="token operator">=</span><span class="token operator">&gt;</span> listener<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  dispatch<span class="token punctuation">(</span><span class="token punctuation">{</span> type: <span class="token string">'@INIT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
    getState,
    subscribe,
    dispatch
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 redux 的实现思想中也包含了 “观察者模式”，例如在 redux 与 React 的配合使用，redux 提供了订阅的方法 subscribe 和派发动作更新 store 的方法 dispatch，React 组件会使用 store 中提供的状态数据，这个 store 就是被观察者，而观察者就是 React 的各个组件，当使用 dispatch 派发动作更新数据时，会执行所有的观察者中的监听函数，实现组件数据与 store 的同步。</p> <h3 id="发布-订阅模式和观察者模式"><a href="#发布-订阅模式和观察者模式" class="header-anchor">#</a> 发布/订阅模式和观察者模式</h3> <p>观察者模式是由 “发布/订阅模式” 演变过来的，都存在订阅、通知的事件机制，“发布/订阅模式” 是对订阅的事件进行统一管理，主动触发通知，依次执行订阅的事件，而 “观察者模式” 是通过一个单独类去订阅观察者，当状态发生变化时通知到各个 “观察者” 实现状态的更新同步。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>“发布/订阅模式” 与 “观察者模式” 的区别：

* “发布/订阅模式” 事件是统一由调度中心调度，订阅发布不存在依赖；
* “观察者模式” 事件是被观察者调度，订阅与发布是存在依赖的；
</code></pre></div><h3 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>“观察者模式” 的意义就在于可以使多个对象数据重合的部分进行复用，同时还可以对各个对象之间解耦，最重要的是数据更新可以及时通知所有数据的使用者进行数据同步.
</code></pre></div><h2 id="_3-工厂模式"><a href="#_3-工厂模式" class="header-anchor">#</a> 3.工厂模式</h2> <h3 id="简单工厂模式"><a href="#简单工厂模式" class="header-anchor">#</a> 简单工厂模式</h3> <p>“简单工厂模式” 是由一个工厂对象决定创建出哪一种产品类的实例。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 直接创建子类实例 */
// 父类
class Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'I am growing!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— Apple
class Apple extends Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— Orange
class Orange extends Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 直接创建子类的实例
const apple <span class="token operator">=</span> new Apple<span class="token punctuation">(</span><span class="token string">'苹果'</span>, <span class="token string">'甜'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const orange <span class="token operator">=</span> new Orange<span class="token punctuation">(</span><span class="token string">'橘子'</span>, <span class="token string">'酸'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>apple.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 甜
console.log<span class="token punctuation">(</span>orange.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 酸
</code></pre></div><p>上面创建子类实例的方式是使用 new 关键字直接创建，这种创建方式使产生的实例和具体的类紧紧的耦合在一起，并依赖于类的具体实现，如果在子类可能随时发生变化的代码中，将对维护造成麻烦，使用 “简单工厂模式” 可以对产生的实例和具体的类进行解耦，且不必关心子类的具体实现和在未来是否发生变化。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 使用简单工厂模式创建子类的实例 */
// 父类
class Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">grow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'I am growing!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— Apple
class Apple extends Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— Orange
class Orange extends Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 工厂类
class Factory <span class="token punctuation">{</span>
  static create<span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    switch <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'apple'</span><span class="token builtin class-name">:</span>
        <span class="token builtin class-name">return</span> new Apple<span class="token punctuation">(</span><span class="token string">'苹果'</span>, <span class="token string">'甜'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'orange'</span><span class="token builtin class-name">:</span>
        <span class="token builtin class-name">return</span> new Orange<span class="token punctuation">(</span><span class="token string">'桔子'</span>, <span class="token string">'酸'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      default:
        throw new Error<span class="token punctuation">(</span><span class="token string">'no constructor!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 使用简单工厂创建子类实例
const apple <span class="token operator">=</span> Factory.create<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const orange <span class="token operator">=</span> Factory.create<span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>apple.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 甜
console.log<span class="token punctuation">(</span>orange.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 酸
</code></pre></div><p>从上面代码看，我们只需要通过类型就可以得到某一个子类的实例，不需要知道子类是谁，以及具体实现，并在工厂 Factory 中做了错误处理，可以不必担心未来某一个子类发生变化或者被删除的问题。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 简单工厂经典案例 —— jQuery */
// jQuery 的构造函数
class JQuery <span class="token punctuation">{</span>
  constructor <span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.selector <span class="token operator">=</span> selector<span class="token punctuation">;</span>
    const elements <span class="token operator">=</span> document.querySelectorAll<span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.length <span class="token operator">=</span> elements.length<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> this.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.innerHTML<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 简单工厂函数
window.$ <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> new JQuery<span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 获取 li 标签并调用 html 方法
const html <span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>'li'<span class="token variable">)</span></span>.html<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 简单工厂经典案例 —— React 虚拟 DOM */
// 创建虚拟 DOM 的构造函数
class VNode <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>tagName, attrs, children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.tagName <span class="token operator">=</span> tagName<span class="token punctuation">;</span>
    this.attrs <span class="token operator">=</span> attrs<span class="token punctuation">;</span>
    this.children <span class="token operator">=</span> children<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 挂在 React 对象上的简单工厂函数
React.createElement <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>tagName, attrs, children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> new VNode<span class="token punctuation">(</span>tagName, attrs, children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>简单工厂模式的缺点：不满足开放封闭原则，内部可以随意修改，新增、修改子类都需要修改工厂类内部代码，在扩展的过程中工厂类的代码将会越来越臃肿。
</code></pre></div><h3 id="工厂方法模式"><a href="#工厂方法模式" class="header-anchor">#</a> 工厂方法模式</h3> <p>“工厂方法模式” 可以规避 “简单工厂模式” 的缺点，又称为 “多态性工厂模式”，核心的工厂类不再负责创建出哪一种产品类的实例，而是将具体创建的工作交给子类去做。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 基本的工厂方法模式使用 */
// 父类
class Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— Apple
class Apple extends Plant <span class="token punctuation">{</span>
  constructor <span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— Orange
class Orange extends Plant <span class="token punctuation">{</span>
  constructor <span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 父类工厂（提供工厂类所共有的内容，依赖倒置原则，依赖抽象而不依赖实现）
class Factory <span class="token punctuation">{</span>
  <span class="token function-name function">create</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类工厂 —— AppleFactory
class AppleFactory extends Factory <span class="token punctuation">{</span>
  static <span class="token function-name function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new Apple<span class="token punctuation">(</span><span class="token string">'苹果'</span>, <span class="token string">'甜'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类工厂 —— OrangeFactory
class OrangeFactory extends Factory <span class="token punctuation">{</span>
  static <span class="token function-name function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new Orange<span class="token punctuation">(</span><span class="token string">'桔子'</span>, <span class="token string">'酸'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 创建实例
const apple <span class="token operator">=</span> AppleFactory.create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const orange <span class="token operator">=</span> OrangeFactory.create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>apple.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 甜
console.log<span class="token punctuation">(</span>orange.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 酸
</code></pre></div><p>上面是一个基础的 “工厂方法模式” 使用，解决了 “简单工厂模式” 扩展的问题（遵循开放封闭原则），创建实例虽然不耦合具体的类，但是耦合工厂的子类，下面可以通过文件拆分进行解耦。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* plant.js */
// 父类
class Plant <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module.exports <span class="token operator">=</span> Plant<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* factory.js */
// 父类工厂（提供工厂类所共有的内容，依赖倒置原则，依赖抽象而不依赖实现）
class Factory <span class="token punctuation">{</span>
  <span class="token function-name function">create</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module.exports <span class="token operator">=</span> Factory<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* apple.js */
const Plant <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./plant'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const Factory <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./factory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 子类 —— Apple
class Apple extends Plant <span class="token punctuation">{</span>
  constructor <span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类工厂 —— AppleFactory
class AppleFactory extends Factory <span class="token punctuation">{</span>
  static <span class="token function-name function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new Apple<span class="token punctuation">(</span><span class="token string">'苹果'</span>, <span class="token string">'甜'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module.exports <span class="token operator">=</span> AppleFactory<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* orange.js */
const Plant <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./plant'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const Factory <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./factory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 子类 —— Orange
class Orange extends Plant <span class="token punctuation">{</span>
  constructor <span class="token punctuation">(</span>name, flavour<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.flavour <span class="token operator">=</span> flavour<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类工厂 —— OrangeFactory
class OrangeFactory extends Factory <span class="token punctuation">{</span>
  static <span class="token function-name function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new Orange<span class="token punctuation">(</span><span class="token string">'桔子'</span>, <span class="token string">'酸'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module.exports <span class="token operator">=</span> OrangeFactory<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* setting.js */
// 配置文件，将要创建实例的类型与对应的工厂关联起来
const setting <span class="token operator">=</span> <span class="token punctuation">{</span>
  apple: <span class="token string">'./apple'</span>,
  orange: <span class="token string">'./orange'</span>,
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module.exports <span class="token operator">=</span> setting<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* use.js */
const setting <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./setting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const apple <span class="token operator">=</span> require<span class="token punctuation">(</span>setting<span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>.create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const orange <span class="token operator">=</span> require<span class="token punctuation">(</span>setting<span class="token punctuation">[</span><span class="token string">'orange'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>.create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>apple.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 甜
console.log<span class="token punctuation">(</span>orange.flavour<span class="token punctuation">)</span><span class="token punctuation">;</span> // 酸
</code></pre></div><p>使用上面这样的 “工厂方法模式”，扩展时只需要新增一个文件，在文件中定义具体创建实例的类和工厂类就可以了，一般会有一个配置文件将要创建实例的类型和对应的工厂关联起来，创建对应的实例只需通过类型和配置文件找到对应的工厂执行 create 方法即可。</p> <h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="header-anchor">#</a> 抽象工厂模式</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>// 父类 —— Icon
class Icon <span class="token punctuation">{</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 父类 —— Button
class Button <span class="token punctuation">{</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— AppleIcon 苹果图标
class AppleIcon extends Icon <span class="token punctuation">{</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'绘制 Mac 的图标'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— AppleButton 苹果按钮
class AppleButton extends Button <span class="token punctuation">{</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'绘制 Mac 的按钮'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— WindowsIcon Windows 图标
class WindowsIcon extends Icon <span class="token punctuation">{</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'绘制 Windows 的图标'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类 —— WindowsButton Windows 按钮
class WindowsButton extends Button <span class="token punctuation">{</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'绘制 Windows 的按钮'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 父类工厂
class Factory <span class="token punctuation">{</span>
  <span class="token function-name function">createIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> // 创建图标
  <span class="token function-name function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> // 创建按钮
<span class="token punctuation">}</span>

// 子类工厂 —— AppleFactory 用于创建苹果族产品实例
class AppleFactory extends Factory <span class="token punctuation">{</span>
  <span class="token function-name function">createIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new AppleIcon<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new AppleButton<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子类工厂 —— WindowsFactory 用于创建 Windows 族产品实例
class WindowsFactory extends Factory <span class="token punctuation">{</span>
  <span class="token function-name function">createIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new WindowsIcon<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">createButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new WindowsButton<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 创建苹果工厂实例
const appleFactory <span class="token operator">=</span> new AppleFactory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 创建苹果族产品
appleFactory.createIcon<span class="token punctuation">(</span><span class="token punctuation">)</span>.render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 绘制 Mac 的图标
appleFactory.createButton<span class="token punctuation">(</span><span class="token punctuation">)</span>.render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 绘制 Mac 的按钮

// 创建 Windows 工厂实例
const wondowsFactory <span class="token operator">=</span> new WindowsFactory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 创建 Windows 族产品
wondowsFactory.createIcon<span class="token punctuation">(</span><span class="token punctuation">)</span>.render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 绘制 Windows 的图标
wondowsFactory.createButton<span class="token punctuation">(</span><span class="token punctuation">)</span>.render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 绘制 Windows 的按钮
</code></pre></div><p>在上面案例中，按照 “抽象工厂模式” 的说法，多个抽象角色指的是 Apple 和 Windows，Icon 和 Button，工厂分为 AppleFactory 和 WindowsFactory 两类，可以分别创建对应产品的 Icon 和 Button 实例。</p> <h3 id="总结-3"><a href="#总结-3" class="header-anchor">#</a> 总结</h3> <p>上面几种工厂模式中，“简单工厂模式” 在框架开发中使用居多，“工厂方法模式” 更多在一些比较老的且复杂的项目中用作业务模块封装和抽象，“抽象工厂模式” 在前端并不常用，应用于后端偏多。</p> <h2 id="_4-适配器模式"><a href="#_4-适配器模式" class="header-anchor">#</a> 4.适配器模式</h2> <h3 id="适配器模式的概念"><a href="#适配器模式的概念" class="header-anchor">#</a> 适配器模式的概念</h3> <p>“适配器模式” 是指类的使用者和类的接口定义格式不符合时，通过一个中间类进行转换。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// 类 Power
class Power <span class="token punctuation">{</span>
  <span class="token function-name function">charge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token string">'220V'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 适配器
class Adaptor <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>Power<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.power <span class="token operator">=</span> new Power<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">chargeTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.power.charge<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token string">' =&gt; 22V'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 类 Power 的使用者
class Notepad <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>Power<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.adaptor <span class="token operator">=</span> new Adaptor<span class="token punctuation">(</span>Power<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>this.adaptor.chargeTransform<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const notepad <span class="token operator">=</span> new Notepad<span class="token punctuation">(</span>Power<span class="token punctuation">)</span><span class="token punctuation">;</span>
notepad.use<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 220V <span class="token operator">=</span><span class="token operator">&gt;</span> 22V
</code></pre></div><p>上面代码中有三个类，Power 类为电源，提供 220V 电压，Notepad 为我们的电子设备，使用电压 22V，明显两个类是不匹配的，此时的 Adaptor 就是一个适配器，作用是连接 Power 与 Notepad，将 220V 转换为 22V。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>适配器模式中，通常作为适配器的类内部会存储被转换类实例的引用。
</code></pre></div><h3 id="适配器模式的应用"><a href="#适配器模式的应用" class="header-anchor">#</a> 适配器模式的应用</h3> <h4 id="适配参数和返回数据"><a href="#适配参数和返回数据" class="header-anchor">#</a> 适配参数和返回数据</h4> <p>在浏览器通过 Ajax 与服务端交互时，封装的请求方法会有默认参数，如果传入了参数则使用传入的参数，如果没有传入，则使用默认的参数，这是参数的适配。</p> <p>在请求响应后，后端会返回给我们 JSON 格式的数据，我们在使用时希望转换成对象使用，这个转换的适配是数据接口的适配。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// 请求方法
<span class="token keyword">function</span> ajax<span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    method: <span class="token string">'GET'</span>,
    dataType: <span class="token string">'JSON'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  initParams<span class="token punctuation">(</span>options, defaultOptions<span class="token punctuation">)</span><span class="token punctuation">;</span> // 适配参数
<span class="token punctuation">}</span>

// 参数适配器
<span class="token keyword">function</span> initParams<span class="token punctuation">(</span>options, defaultOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>let attr <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    defaultOptions<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">||</span> defaultOptions<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token builtin class-name">return</span> defaultOptions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 数据适配器
<span class="token keyword">function</span> tranformData<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> JSON.parse<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 使用适配器
ajax<span class="token punctuation">(</span><span class="token punctuation">{</span>
  url: <span class="token string">'www.pandashen.com'</span>,
  method: <span class="token string">'POST'</span>,
  success<span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const result <span class="token operator">=</span> tranformData<span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> // 适配返回数据
    console.log<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="适配转换-promise"><a href="#适配转换-promise" class="header-anchor">#</a> 适配转换 Promise</h4> <p>在 Node.js 的 fs 模块中有很多异步的方法，比如 readFile，读取文件获取结果后想要继续读取下一个文件，以此类推就产生了 “回调地狱”，代码的可读性和维护性会变差，我们可以通过 “适配器模式” 将这些方法转化为 Promise 实例。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>const fs <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 适配成 Promise
<span class="token keyword">function</span> promisify<span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> new Promise<span class="token punctuation">((</span>resolve, reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      fn.call<span class="token punctuation">(</span>null, <span class="token punctuation">..</span>.args, <span class="token punctuation">(</span>err, data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        err ? reject<span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> resolve<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 使用适配后的方法
const readFile <span class="token operator">=</span> promisify<span class="token punctuation">(</span>fs.readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
readFile<span class="token punctuation">(</span><span class="token string">'index.txt'</span>, <span class="token string">'utf-8'</span><span class="token punctuation">)</span>.then<span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> // Hello world
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="适配技术栈变更后的旧代码"><a href="#适配技术栈变更后的旧代码" class="header-anchor">#</a> 适配技术栈变更后的旧代码</h4> <p>在一些老项目是 jQuery 的技术栈，请求也使用的是自带的 $.ajax，如果一天项目中决定移除 jQuery，请求方法 $.ajax 自然也跟着移除了，假设我们想使用 fetch 来代替 $.ajax，则要修改大量的代码，这时 “适配器模式” 可以对 fetch 进行适配，让我们继续沿用 $.ajax 的写法。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// 适配器
window.$ <span class="token operator">=</span> <span class="token punctuation">{</span>
  ajax<span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> fetch<span class="token punctuation">(</span>options.url, <span class="token punctuation">{</span>
      method: options.type <span class="token operator">||</span> <span class="token string">'GET'</span>,
      body: JSON.stringifily<span class="token punctuation">(</span>options.data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>.then<span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">&gt;</span> res.json<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

// $.ajax 的旧代码
$.ajax<span class="token punctuation">(</span><span class="token punctuation">{</span>
  url: <span class="token string">'pandashen.com/info'</span>,
  type: <span class="token string">'POST'</span>,
  dataType: <span class="token string">'json'</span>,
  data: <span class="token punctuation">{</span> id: <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>.then<span class="token punctuation">(</span>function <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结-4"><a href="#总结-4" class="header-anchor">#</a> 总结</h3> <p>“适配器模式” 是很常用的设计模式之一，Vue 的 computed 计算属性、Koa 兼容 1.x 和 2.x 版本的转换中间件 koa-convert 都应用了 “适配器模式”.</p> <h2 id="_5-装饰器模式"><a href="#_5-装饰器模式" class="header-anchor">#</a> 5.装饰器模式</h2> <h3 id="装饰器模式概念"><a href="#装饰器模式概念" class="header-anchor">#</a> 装饰器模式概念</h3> <p>“装饰器模式” 是结构型模式之一，在不改变原有对象结构的前提下，给对象添加新功能，也可以理解 “装饰器模式” 是将一个对象嵌入另一个对象之中，相当于一个对象被另一个对象包装，包装其他对象的对象被称为 “装饰器”。</p> <h3 id="装饰器模式和适配器模式"><a href="#装饰器模式和适配器模式" class="header-anchor">#</a> 装饰器模式和适配器模式</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 装饰器模式案例 */
// 类 Duck
class Duck <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  eat<span class="token punctuation">(</span>food<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>this.name + <span class="token string">'吃'</span> + food<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 装饰器类 TangDuck，装饰 Duck 类
class TangDuck <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.duck <span class="token operator">=</span> new Duck<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  eat<span class="token punctuation">(</span>food<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.duck.eat<span class="token punctuation">(</span>food<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console.log<span class="token punctuation">(</span><span class="token string">'说谢谢'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const tangDuck <span class="token operator">=</span> new TangDuck<span class="token punctuation">(</span><span class="token string">'唐老鸭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tangDuck.eat<span class="token punctuation">(</span><span class="token string">'苹果'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
// 唐老鸭吃苹果
// 说谢谢
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 适配器模式案例 */
// 类 Power
class Power <span class="token punctuation">{</span>
  <span class="token function-name function">charge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token string">'220V'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 适配器
class Adaptor <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>Power<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.power <span class="token operator">=</span> new Power<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">chargeTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.power.charge<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token string">' =&gt; 22v'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 类 Power 的使用者
class Notepad <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>Power<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.adaptor <span class="token operator">=</span> new Adaptor<span class="token punctuation">(</span>Power<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>this.adaptor.chargeTransform<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面分别是 “装饰器模式” 和 “适配器模式” 的案例，但直接看代码可能会将两者混淆，原因是 “适配器” 和 “装饰器” 的类都存在了一个被装饰或者适配转换的类的引用，不同的是，“装饰器” 仅仅是对某一个类进行包装，并不会改变原来类的结构，而 “适配器” 的作用更多是去建立一个类和另一个类之间的关系和转换</p> <h3 id="装饰器模式和继承"><a href="#装饰器模式和继承" class="header-anchor">#</a> 装饰器模式和继承</h3> <p>通过上一节，我们已经知道了什么是 “装饰器模式”，下面有一个更直观的例子，我们有一个基础类 Coffee，组成是咖啡加水，这个基础上可以加奶、糖、冰，需求是可以组合加入上面的其他原料，并计算出对应的价格，大家可能第一时间想到的是继承的方式实现。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 继承的实现方式 */
// 水 + 咖啡
class Coffee <span class="token punctuation">{</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> water + <span class="token string">' + 咖啡'</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 水 + 奶 + 咖啡
class MilkCoffee extends Coffee <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 奶'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 水 + 糖 + 咖啡
class SugarCoffee extends Coffee <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 糖'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 水 + 糖 + 奶 + 咖啡
class SugarMilkCoffee extends SugarCoffee <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 奶'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 水 + 奶 + 糖 + 咖啡
class MilkSugarCoffee extends MilkCoffee <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 糖'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> super.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从继承的代码看，虽然可以实现给咖啡任意加入其他原料，但是每一种不同的排列组合都需要单独创建类，当原料种类众多时，则难以管理代码，下面是 “装饰器模式” 的实现</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 装饰器模式的实现方式 */
class Coffee <span class="token punctuation">{</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> water + <span class="token string">' + 咖啡'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class MilkCoffee <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.parent.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 奶'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.parent.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class SugarCoffee <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.parent.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 糖'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.parent.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class IceCoffee <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.parent.make<span class="token punctuation">(</span>water<span class="token punctuation">)</span> + <span class="token string">' + 冰'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.parent.cost<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const coffee <span class="token operator">=</span> new Coffee<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const milkCoffee <span class="token operator">=</span> new MilkCoffee<span class="token punctuation">(</span>coffee<span class="token punctuation">)</span><span class="token punctuation">;</span>
const sugarCoffee <span class="token operator">=</span> new SugarCoffee<span class="token punctuation">(</span>milkCoffee<span class="token punctuation">)</span><span class="token punctuation">;</span>
const iceCoffee <span class="token operator">=</span> new IceCoffee<span class="token punctuation">(</span>sugarCoffee<span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>milkCoffee.make<span class="token punctuation">(</span><span class="token string">'水'</span><span class="token punctuation">)</span>, milkCoffee.cost<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>sugarCoffee.make<span class="token punctuation">(</span><span class="token string">'水'</span><span class="token punctuation">)</span>, sugarCoffee.cost<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>iceCoffee.make<span class="token punctuation">(</span><span class="token string">'水'</span><span class="token punctuation">)</span>, iceCoffee.cost<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

// 水 + 咖啡 + 奶 <span class="token number">13</span>
// 水 + 咖啡 + 奶 + 糖 <span class="token number">15</span>
// 水 + 咖啡 + 奶 + 冰 <span class="token number">16</span>
</code></pre></div><p>从 “装饰器模式” 的实现代码来看，我们只需要创建和原料相同多的类就可以了，其他的方式加料只需要对上一个类进行包装即可，部分加料的顺序，当类的种类越多时，“装饰器” 的意义则体现的越明显。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>装饰器模式有时候会优于继承，尤其是很多的类通过继承存在排列组合的关系时，则使用 “装饰器模式” 可以更好更高效的解决问题。
</code></pre></div><h3 id="装饰器模式和-aop-编程"><a href="#装饰器模式和-aop-编程" class="header-anchor">#</a> 装饰器模式和 AOP 编程</h3> <p>在软件业，AOP 为 Aspect Oriented Programming 的缩写，意为面向切面编程，通过预编译方式和运行其动态代理实现程序功能统一维护的一种技术。</p> <p>在 JavaScript 中的 AOP 就是在函数之前或之后添加一些额外的逻辑，而不需要修改函数本身逻辑。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* AOP 编程的案例 */
// 给函数扩展 before 方法
Function.prototype.before <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>beforeFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> _this <span class="token operator">=</span> this<span class="token punctuation">;</span>
  <span class="token builtin class-name">return</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beforeFn.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _this.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 给函数扩展 after 方法
Function.prototype.after <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>afterFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">let</span> _this <span class="token operator">=</span> this<span class="token punctuation">;</span>
  <span class="token builtin class-name">return</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _this.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    afterFn.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 原函数
<span class="token keyword">function</span> buy<span class="token punctuation">(</span>money, goods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'花'</span> + money + <span class="token string">'元钱买'</span> + goods<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// 使用 before 方法给函数增加前切面
buy <span class="token operator">=</span> buy.before<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'向媳妇要1元钱'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 使用 before 方法给函数增加后切面
buy <span class="token operator">=</span> buy.after<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'还给媳妇0.2元钱'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

buy<span class="token punctuation">(</span><span class="token number">0.8</span>, <span class="token string">'盐'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
// 向媳妇要1元钱
// 花0.8元钱买盐
// 还给媳妇0.2元钱
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>AOP 编程是由 “装饰器模式” 进化而来，或者说 “装饰器模式” 属于 AOP 编程的一种。
</code></pre></div><h3 id="装饰器模式的应用"><a href="#装饰器模式的应用" class="header-anchor">#</a> 装饰器模式的应用</h3> <h4 id="监控埋点"><a href="#监控埋点" class="header-anchor">#</a> 监控埋点</h4> <p>埋点分析，是网站分析的一种常用的数据采集方法，埋点主要分为服务器层面的埋点和客户端层面的埋点，服务器层面的埋点主要是通过客户端的请求进行分析，客户端层面的埋点分为代码埋点、自动化埋点，第三方埋点（百度、友盟等）。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- 一个埋点的简单案例 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>埋点<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button data-name<span class="token operator">=</span><span class="token string">&quot;wetermelon&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;wetermelon&quot;</span><span class="token operator">&gt;</span>西瓜<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button data-name<span class="token operator">=</span><span class="token string">&quot;apple&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;apple&quot;</span><span class="token operator">&gt;</span>苹果<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    const wetermelon <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'wetermelon'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    const apple <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 添加切面
    Function.prototype.after <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>afterFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">let</span> _this <span class="token operator">=</span> this<span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _this.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        afterFn.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    // 事件处理函数
    <span class="token keyword">function</span> <span class="token function-name function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'你点击了'</span> + this.dataset.name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    click <span class="token operator">=</span> click.after<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      // 向服务器发送统计数据
      const img <span class="token operator">=</span> new Image<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      img.src <span class="token operator">=</span> <span class="token string">'http://localhost:3000/report?name='</span> + this.dataset.name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 给所有的
    Array.from<span class="token punctuation">(</span>document.querySelectorAll<span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">))</span>.forEach<span class="token punctuation">(</span>button <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      button.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, click<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 负责统计点击次数的服务 */
const express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 存储按钮的点击次数
const goods <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/report'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const name <span class="token operator">=</span> req.query.name<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>goods<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    goods<span class="token punctuation">[</span>name<span class="token punctuation">]</span>++<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    goods<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  res.json<span class="token punctuation">(</span>goods<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.listen<span class="token punctuation">(</span><span class="token number">3000</span>, <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'server start 3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的埋点就是通过 AOP 的方式在点击事件后添加了切面，用来向服务器发送请求，符合 “单一职责原则”，可以使点击事件和埋点逻辑进行 “解耦”，服务器在接收到请求之后立即对点击次数进行统计并储存，也可以通过调用 report 接口来获取当前各个按钮的点击次数。</p> <h4 id="表单校验"><a href="#表单校验" class="header-anchor">#</a> 表单校验</h4> <p>“装饰器模式” 的思想同样可以用在表单校验，通常表单校验逻辑是在 submit 事件触发时提交之前发生的，我们经常会将校验逻辑和提交逻辑写在一起，形成 “强耦合”，下面我们使用 AOP 的方式来实现表单校验，对校验逻辑和提交逻辑进行 “解耦”。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- 应用于表单校验 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>表单校验<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  用户名：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>
  密码：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;submit-btn&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    const submitBtn <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'submit-btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 添加切面函数
    Function.prototype.before <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>beforeFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">let</span> _this <span class="token operator">=</span> this<span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">let</span> result <span class="token operator">=</span> beforeFn.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">&amp;&amp;</span> _this.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    // 表单提交事件
    <span class="token keyword">function</span> <span class="token function-name function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'提交表单'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    // 验证用户名
    submit <span class="token operator">=</span> submit.before<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      const username <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>.value<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> alert<span class="token punctuation">(</span><span class="token string">'请输入用户名'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    // 验证
    submit <span class="token operator">=</span> submit.before<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      const password <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>.value<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> alert<span class="token punctuation">(</span><span class="token string">'请输入密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    submitBtn.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, submit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div><h3 id="总结-5"><a href="#总结-5" class="header-anchor">#</a> 总结</h3> <p>在 JavaScript 中 “装饰器模式” 和 AOP 编程非常相似，应用也非常多，如 axios 中对请求、响应的拦截方法，Koa 中间件，都包含这样的编程思想，而在 ES6 之后 JavaScript 已经支持了原生的 “装饰器” 语法，使用起来更方便.</p> <h2 id="_6-代理模式"><a href="#_6-代理模式" class="header-anchor">#</a> 6.代理模式</h2> <h3 id="代理模式概念"><a href="#代理模式概念" class="header-anchor">#</a> 代理模式概念</h3> <p>由于某些情况下一个对象不能直接引用另一个对象，所以需要代理对象在这两个对象之间起到中介作用或者实现控制，这样的模式叫 “代理模式”。</p> <h3 id="基本实现"><a href="#基本实现" class="header-anchor">#</a> 基本实现</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>// 假设无法客户端无法直接使用这个类
class Google <span class="token punctuation">{</span>
  get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> url + <span class="token string">' is google'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 只能通过代理操作 Google 类
class Proxy <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.google <span class="token operator">=</span> new Google<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.google.get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const proxy <span class="token operator">=</span> new Proxy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const result <span class="token operator">=</span> proxy.get<span class="token punctuation">(</span><span class="token string">'http://www.google.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> // http://www.google.com is google
</code></pre></div><p>假设 Google 类我们无法直接使用，只有 Proxy 可以使用 Google，我们可以通过 Proxy 类去操作使用 Google 类，此时 Proxy 类就是一个代理。</p> <h3 id="es6-的-proxy"><a href="#es6-的-proxy" class="header-anchor">#</a> ES6 的 Proxy</h3> <p>在 ES6 标准以后，JavaScript 提供了原生的代理模式 Proxy 类，可以代理其他对象，并在对象属性的获取和赋值时增加拦截。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* ES6 Proxy 的使用 */
const lucy <span class="token operator">=</span> <span class="token punctuation">{</span>
  name: <span class="token string">'lucy'</span>,
  age: <span class="token number">20</span>,
  height: <span class="token number">165</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

const lucyMother <span class="token operator">=</span> new Proxy<span class="token punctuation">(</span>lucy, <span class="token punctuation">{</span>
  get<span class="token punctuation">(</span>target, key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> target.age - <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'height'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> target.height + <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  set<span class="token punctuation">(</span>target, key, val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'boyfriend'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val.age <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console.log<span class="token punctuation">(</span><span class="token string">'太老了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val.salary <span class="token operator">&lt;</span> <span class="token number">20000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console.log<span class="token punctuation">(</span><span class="token string">'太穷了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>lucyMother.name<span class="token punctuation">)</span><span class="token punctuation">;</span> // lucy
console.log<span class="token punctuation">(</span>lucyMother.age<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token number">18</span>
console.log<span class="token punctuation">(</span>lucyMother.height<span class="token punctuation">)</span><span class="token punctuation">;</span> // <span class="token number">170</span>

lucyMother.boyfriend <span class="token operator">=</span> <span class="token punctuation">{</span>
  age: <span class="token number">42</span>,
  salary: <span class="token number">25000</span>
<span class="token punctuation">}</span>
// 太老了

lucyMother.boyfriend <span class="token operator">=</span> <span class="token punctuation">{</span>
  age: <span class="token number">36</span>,
  salary: <span class="token number">18000</span>
<span class="token punctuation">}</span>
// 太穷了
</code></pre></div><p>上面是一个接地气的案例，创建一个对象存储 lucy 的基本信息，使用代理创建 lucyMother 为 lucy 找男朋友，通过代理对象获取 lucy 的基本信息时会虚报年龄和身高，而在设置男朋友对象时会检查是否符合要求。</p> <h3 id="代理模式、适配器模式和装饰器模式"><a href="#代理模式、适配器模式和装饰器模式" class="header-anchor">#</a> 代理模式、适配器模式和装饰器模式</h3> <p>从代码实现来看，代理模式、适配器模式、装饰器模式非常的相似，非常容易混淆，但其实是有本质区别的。</p> <ul><li>代理模式和适配器模式：代理模式不会改变原有的接口，代理类和被代理的类属性方法使用方式完全一致，而适配器模式是因为旧的接口无法使用，通过适配器创建新的接口去兼容旧的接口；</li> <li>代理模式和装饰器模式：装饰器功能会保证被装饰类功能正常使用的情况下新增功能，而代理模式保证原有接口，但会改变原来接口的功能；</li> <li>适配器模式和装饰器模式：装饰器是对一个类的包装，而适配器更多是去建立提供接口的类与无法适配的类之间的联系。</li></ul> <h3 id="代理模式的应用"><a href="#代理模式的应用" class="header-anchor">#</a> 代理模式的应用</h3> <h4 id="事件委托"><a href="#事件委托" class="header-anchor">#</a> 事件委托</h4> <p>事件委托是浏览器事件注册的一种优化手段，如果同类型的元素非常多，且都有相同的事件，如列表，则不必给每一个元素注册这个事件，而是将事件注册给父元素，即将事件委托给父元素，避免了相同事件的重复注册，这种优化利用了 “代理模式”，又称事件代理。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>事件委托<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ul <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;list&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    const ulList <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ulList.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span>event.target.innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div><p>在浏览器中，委托给父元素的事件触发后，可以通过事件对象的属性 target 获取到具体触发事件的子元素。</p> <h3 id="图片加载"><a href="#图片加载" class="header-anchor">#</a> 图片加载</h3> <p>图片加载是一个提高用户体验的功能，也是非常常见的，原因是浏览器向服务器请求资源图片是需要等待的，由于网络等因素的影响会导致等待的时间更长，此时我们需要一个 loading 图片来过渡，这就是图片加载的基本需求。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* <span class="token function">node</span> 服务器 */
const express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const path <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/loading.gif'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res.sendFile<span class="token punctuation">(</span>path.resolve<span class="token punctuation">(</span><span class="token string">'img'</span>, <span class="token string">'loading.gif'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/img/:name'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  setTimeout<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res.sendFile<span class="token punctuation">(</span>path.join<span class="token punctuation">(</span>__dirname, req.path<span class="token punctuation">))</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>, <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.use<span class="token punctuation">(</span>express.static<span class="token punctuation">(</span>__dirname<span class="token punctuation">))</span><span class="token punctuation">;</span>

app.listen<span class="token punctuation">(</span><span class="token number">3000</span>, <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token string">'server start 3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面服务器模拟了加载图片响应慢的场景，loading 图片立即响应，其他图片则延迟 3s 响应。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- Dom 结构 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>ul <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;menu&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li data-src<span class="token operator">=</span><span class="token string">&quot;/img/bg1.jpg&quot;</span><span class="token operator">&gt;</span>图片<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/li<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li data-src<span class="token operator">=</span><span class="token string">&quot;/img/bg2.jpg&quot;</span><span class="token operator">&gt;</span>图片<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/ul<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;bgimg&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>/* 没有实现 loading */
const menu <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const bgimg <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'bgimg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const background <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const img <span class="token operator">=</span> new Image<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bgimg.appendChild<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
    setSrc<span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      img.src <span class="token operator">=</span> src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

menu.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const src <span class="token operator">=</span> event.target.dataset.src<span class="token punctuation">;</span>
  background.setSrc<span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码是没有实现懒加载的，当点击按钮向服务器请求图片时，并没有加入 loading 图片过渡，之所以说图片加载应用了 “代理模式” 并不是指加载功能本身，而是我们的实现方式，编写的代码质量要高至少要遵循单一职责原则和开放封闭原则，就是说最好不要直接在事件监听的函数中增加 loading 过渡的逻辑，而是把这个过渡功能交给代理对象去处理。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 使用代理对象实现 loading 过渡 */
const menu <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const bgimg <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'bgimg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 请求图片的对象
const background <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const img <span class="token operator">=</span> new Image<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bgimg.appendChild<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
    setSrc<span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      img.src <span class="token operator">=</span> src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 增加 loading 过度的代理对象
const proxyBackground <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const img <span class="token operator">=</span> new Image<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  img.onload <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    background.setSrc<span class="token punctuation">(</span>this.src<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token builtin class-name">return</span> <span class="token punctuation">{</span>
    setSrc<span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      background.setSrc<span class="token punctuation">(</span><span class="token string">'./img/loading.gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      img.src <span class="token operator">=</span> src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// 监听获取图片的事件中使用的是代理对象 proxyBackground
menu.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const src <span class="token operator">=</span> event.target.dataset.src<span class="token punctuation">;</span>

  // 防止缓存
  proxyBackground.setSrc<span class="token punctuation">(</span>src + <span class="token string">'?time='</span> + Date.now<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的实现方式就符合 “代理模式”，background 对象是提供基本功能，而proxyBackground（代理对象）增强了基本功能，却并没有改变接口的使用方式，依然通过 setSrc 方法去请求图片。</p> <h3 id="防抖代理"><a href="#防抖代理" class="header-anchor">#</a> 防抖代理</h3> <p>防抖的作用是在做一个操作时不需要很频繁，如搜索查询，在连续输入时如果每次触发输入事件都向后端发送请求，性能是极差的，我们希望的是连续输入只在最后一次统一发送请求，这种处理叫做防抖处理，是前端优化的手段。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- 未使用防抖代理处理 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;ipt&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  const ipt <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'ipt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function-name function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'发送请求了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  ipt.addEventListener<span class="token punctuation">(</span><span class="token string">'input'</span>, post<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>上面代码未使用防抖代理，每次输入都会打印 “发送请求了”。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- 使用防抖代理优化 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;ipt&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  const ipt <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'ipt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function-name function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'发送请求了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  // 代理函数去执行 post
  const debouncePost <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">let</span> timer <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      clearInterval<span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> setTimeout<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        post<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>, <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  ipt.addEventListener<span class="token punctuation">(</span><span class="token string">'input'</span>, debouncePost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>使用防抖代理函数优化后，保留了原有功能的基础上进行了增强，实现了连续输入停止 500ms 后统一发送一次请求，防抖的实现方式有很多种，包括并不限于函数式编程等，而上面代码使用了 “代理模式” 实现 。</p> <h3 id="总结-6"><a href="#总结-6" class="header-anchor">#</a> 总结</h3> <p>使用 “代理模式” 的场景在后端会更多，比如代理跨域，Nginx 代理等等，还有一点需要注意的是，“代理模式” 并非单一的，对于同一个对象，可以有多个代理对象去增强不同的功能。</p> <h2 id="_7-外观模式"><a href="#_7-外观模式" class="header-anchor">#</a> 7.外观模式</h2> <h3 id="外观模式简介"><a href="#外观模式简介" class="header-anchor">#</a> 外观模式简介</h3> <p>“外观模式” 就是把一些复杂的流程封装成一个接口，提供给外部更简单的使用。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>在外观模式中存在三种角色如下：

* 门面角色（Facade）：是 “外观模式” 的核心，它熟悉子系统的功能，并被客户角色调用，内部实现了客户角色需求功能的组合；
* 子系统角色（System）：实现了子系统的功能（多个），对于客户角色是未知的；
* 客户角色（Client）：通过调用 Facede 来完成要实现的功能。
</code></pre></div><h3 id="外观模式的实现"><a href="#外观模式的实现" class="header-anchor">#</a> 外观模式的实现</h3> <p>上面已经介绍了 “外观模式” 的各个角色，下面是简单的代码实现。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// 子系统角色 Sum
class Sum <span class="token punctuation">{</span>
  sum<span class="token punctuation">(</span>a, b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> a + b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子系统角色 Minus
class Minus <span class="token punctuation">{</span>
  minus<span class="token punctuation">(</span>a, b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> a - b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子系统角色 Multipy
class Multipy <span class="token punctuation">{</span>
  multipy<span class="token punctuation">(</span>a, b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> a * b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子系统角色 Divide
class Divide <span class="token punctuation">{</span>
  divide<span class="token punctuation">(</span>a, b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> a / b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 门面角色 Calculator
class Calculator <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.sumObj <span class="token operator">=</span> new Sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.minusObj <span class="token operator">=</span> new Minus<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.multipyObj <span class="token operator">=</span> new Multipy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.divideObj <span class="token operator">=</span> new Divide<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  sum<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.sumObj.sum<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  minus<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.minusObj.minus<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  multipy<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.multipyObj.multipy<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  divide<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.divideObj.divide<span class="token punctuation">(</span><span class="token punctuation">..</span>.args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 客户角色
const calculator <span class="token operator">=</span> new Calculator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>calculator.sum<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">3</span>
console.log<span class="token punctuation">(</span>calculator.minus<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token parameter variable">-1</span>
console.log<span class="token punctuation">(</span>calculator.multipy<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">2</span>
console.log<span class="token punctuation">(</span>calculator.divide<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">0.5</span>
</code></pre></div><p>我们在上面代码中实现了一个计算器功能，计算器具备的功能为加、减、乘、除，我们把这四个功能分别拆分成为四个子系统，用门面类 Calculator 来进行连接，这样只需要调用 Calculator 的实例（客户角色）就可以调用四个子系统模块分别提供的功能，但是上面的代码实现功能比较简洁，并没达到 “外观模式” 的真正作用，就是可以随意组合各个子系统的功能。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 组合子系统功能 */
// 子系统角色 CPU
class CPU <span class="token punctuation">{</span>
  <span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'CPU 启动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子系统角色 Memory
class Memory <span class="token punctuation">{</span>
  <span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'内存启动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 子系统角色 Disk
class Disk <span class="token punctuation">{</span>
  <span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'硬盘启动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 门面角色 Computer
class Computer <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.cpu <span class="token operator">=</span> new CPU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.memory <span class="token operator">=</span> new Memory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.disk <span class="token operator">=</span> new Disk<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    // 组合子系统功能
    this.cpu.start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.memory.start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.disk.start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 客户角色
const computer <span class="token operator">=</span> new Computer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

computer.start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
// CPU 启动
// 内存启动
// 硬盘启动
</code></pre></div><p>上面代码打印了一个计算机的启动过程，功能来自于各个子系统，也可以通过门面角色实现子系统功能的多种组合。</p> <h3 id="总结-7"><a href="#总结-7" class="header-anchor">#</a> 总结</h3> <p>“外观模式” 的作用是可以对复杂功能解耦合，分散到各个子系统，使子系统与子系统互相独立，并对各个子系统提供外界访问的功能组合模块，这样既提高了子系统的维护性，又增加了外界访问功能的扩展性。</p> <h2 id="_8-状态模式"><a href="#_8-状态模式" class="header-anchor">#</a> 8.状态模式</h2> <h3 id="状态模式简介"><a href="#状态模式简介" class="header-anchor">#</a> 状态模式简介</h3> <p>有些情况下一个对象的行为取决于一个或者多个动态变化的属性，这样的属性叫做状态，这个对象叫做有状态的对象，这种情况下通常有很多的判断来处理状态不同时代码的执行逻辑，执行逻辑可能会非常复杂，让代码变得难以维护，“状态模式” 就是将这些逻辑委托给外面的对象或类来单独维护，来减少状态对象的逻辑，增强代码的维护性。</p> <h3 id="状态模式的实现"><a href="#状态模式的实现" class="header-anchor">#</a> 状态模式的实现</h3> <p>下面是一个类，功能为根据电池不同状态打印当前不同的颜色，下面是正常的实现方式。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>class Battery <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.amount <span class="token operator">=</span> <span class="token string">'high'</span><span class="token punctuation">;</span> // 电量高
  <span class="token punctuation">}</span>
  <span class="token function-name function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>this.amount <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'high'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'显示绿色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      this.amount <span class="token operator">=</span> <span class="token string">'middle'</span><span class="token punctuation">;</span> // 电量中等
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>this.amount <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'middle'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'显示黄色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      this.amount <span class="token operator">=</span> <span class="token string">'low'</span><span class="token punctuation">;</span> // 电量低
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>this.amount <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'low'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'显示红色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const battery <span class="token operator">=</span> new Battery<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

battery.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 显示绿色
battery.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 显示黄色
battery.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 显示红色
</code></pre></div><p>上面的代码虽然实现了我们想要的功能，但是代码中 show 方法违反了开放封闭原则和单一职责原则，状态切换逻辑不明显，判断条件太多，维护性和扩展性差，下面使用状态模式进行优化。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>class Battery <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.amount <span class="token operator">=</span> <span class="token string">'high'</span><span class="token punctuation">;</span> // 电量高
    this.state <span class="token operator">=</span> new SuccessState<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 绿色状态
  <span class="token punctuation">}</span>
  <span class="token function-name function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    // 把显示逻辑委托给状态对象
    this.state.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>this.amount <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'high'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.amount <span class="token operator">=</span> <span class="token string">'middle'</span><span class="token punctuation">;</span> // 电量中等
      this.state <span class="token operator">=</span> new WarningState<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 黄色状态
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>this.amount <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'middle'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.amount <span class="token operator">=</span> <span class="token string">'low'</span><span class="token punctuation">;</span> // 电量低
      this.state <span class="token operator">=</span> new ErrorState<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 红色状态
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class SuccessState <span class="token punctuation">{</span>
  <span class="token function-name function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'显示绿色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class WarningState <span class="token punctuation">{</span>
  <span class="token function-name function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'显示黄色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class ErrorState <span class="token punctuation">{</span>
  <span class="token function-name function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'显示红色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const battery <span class="token operator">=</span> new Battery<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

battery.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 显示绿色
battery.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 显示黄色
battery.show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 显示红色
</code></pre></div><p>经过 “状态模式” 的优化，我们将状态拆分成三个类，无论关于状态操作的多复杂的逻辑都在拆分出的类中实现，而不再需要在状态对象 Battery 中。</p> <h3 id="状态模式的应用"><a href="#状态模式的应用" class="header-anchor">#</a> 状态模式的应用</h3> <h4 id="点赞"><a href="#点赞" class="header-anchor">#</a> 点赞</h4> <p>点赞是我们在项目开发中经常见到的功能，点赞后也可以取消点赞，这就出现了按钮关于点赞状态的切换和按钮文案的切换，下面是使用 “状态模式” 来实现的点赞功能。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  // 维护点赞渲染逻辑的对象
  const likeState <span class="token operator">=</span> <span class="token punctuation">{</span>
    render<span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element.innerHTML <span class="token operator">=</span> <span class="token string">'赞'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  // 维护取消点赞渲染逻辑的对象
  const likedState <span class="token operator">=</span> <span class="token punctuation">{</span>
    render<span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element.innerHTML <span class="token operator">=</span> <span class="token string">'取消'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  class Button <span class="token punctuation">{</span>
    constructor<span class="token punctuation">(</span>container<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.liked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> // 默认为未点赞状态
      this.state <span class="token operator">=</span> likeState<span class="token punctuation">;</span> // 设置当前的状态为未点赞

      this.element <span class="token operator">=</span> document.createElement<span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container.appendChild<span class="token punctuation">(</span>this.element<span class="token punctuation">)</span><span class="token punctuation">;</span>
      this.render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 初始化渲染
    <span class="token punctuation">}</span>
    setState<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.state <span class="token operator">=</span> state<span class="token punctuation">;</span> // 修改渲染状态
      button.liked <span class="token operator">=</span> <span class="token operator">!</span>button.liked<span class="token punctuation">;</span> // 修改状态属性
      this.render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // 重新渲染
    <span class="token punctuation">}</span>
    <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      this.state.render<span class="token punctuation">(</span>this.element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  // 获取按钮对象并添加点击事件
  const button <span class="token operator">=</span> new Button<span class="token punctuation">(</span>document.getElementById<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
  button.element.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    button.setState<span class="token punctuation">(</span>button.liked ? likeState <span class="token builtin class-name">:</span> likedState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>上面代码使用 “状态模式” 统一封装了按钮的类 Button，传入的参数为渲染按钮的容器元素，按钮类的内部创建按钮并添加到容器元素中，统一管理了点赞状态，点赞渲染对象，如果想要切换状态只需要执行 button 对象提供的 setState 方法通过传入的不同状态对象进行状态切换和页面渲染。</p> <h3 id="react-组件显示隐藏"><a href="#react-组件显示隐藏" class="header-anchor">#</a> React 组件显示隐藏</h3> <p>在 React 中，经常会出现通过事件切换组件的显示隐藏，最简单的方式是通过类组件状态来控制，但其实也可以使用 “状态模式” 在组件外编写对状态更改的逻辑，这样可以使组件的逻辑更清晰，代码更精简。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">import</span> React from <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token function">import</span> ReactDOM from <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

// 状态管理对象
const States <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-name function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'显示 Banner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.setState<span class="token punctuation">(</span><span class="token punctuation">{</span> isShow: <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>,
  <span class="token function-name function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'隐藏 Banner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this.setState<span class="token punctuation">(</span><span class="token punctuation">{</span> isShow: <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

class Banner extends React.Component <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> isShow: <span class="token boolean">true</span> <span class="token punctuation">}</span>
  toggle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    const currentState <span class="token operator">=</span> this.state.isShow ? <span class="token string">'hide'</span> <span class="token builtin class-name">:</span> <span class="token string">'show'</span><span class="token punctuation">;</span>
    States<span class="token punctuation">[</span>currentState<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> States<span class="token punctuation">[</span>currentState<span class="token punctuation">]</span>.apply<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-name function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
          isShow <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>nav<span class="token operator">&gt;</span>导航<span class="token operator">&lt;</span>/nav<span class="token operator">&gt;</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>toggle<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDOM.render<span class="token punctuation">(</span><span class="token operator">&lt;</span>Banner /<span class="token operator">&gt;</span>, document.getElementById<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面代码中组件外部的 States 就是管理切换状态逻辑的对象，就是说 “状态模式” 也可以在框架中单独使用。</p> <h3 id="有限状态机"><a href="#有限状态机" class="header-anchor">#</a> 有限状态机</h3> <p>其实 “状态模式” 来源一个有限状态机的概念，有限状态机是指一个事物拥有多种状态，但是同一时间只会处于一种状态，可以通过动作来改变当前的状态，在 JavaScript 中拥有第三方模块 javascript-state-machine 专门帮我们来做这件事。</p> <h3 id="javascript-state-machine-使用"><a href="#javascript-state-machine-使用" class="header-anchor">#</a> javascript-state-machine 使用</h3> <p>javascript-state-machine 提供一个类，创建实例时传入的参数为一个 options 对象，属性 init 用来定义初始状态值，属性 transitions 用来定义属性变化，methods 用来定义属性发生变化时所触发的钩子。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// 有限状态机对象
const StateMachine <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'javascript-state-machine'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const fsm <span class="token operator">=</span> new StateMachine<span class="token punctuation">(</span><span class="token punctuation">{</span>
  init: <span class="token string">'solid'</span>, // 初始状态（固态）
  transitions: <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> from: <span class="token string">'solid'</span>, to: <span class="token string">'liquid'</span>, name: <span class="token string">'melt'</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span> from: <span class="token string">'liquid'</span>, to: <span class="token string">'solid'</span>, name: <span class="token string">'freeze'</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span> from: <span class="token string">'liquid'</span>, to: <span class="token string">'gas'</span>, name: <span class="token string">'vaporize'</span> <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span> from: <span class="token string">'gas'</span>, to: <span class="token string">'liquid'</span>, name: <span class="token string">'condense'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  methods: <span class="token punctuation">{</span>
    <span class="token function-name function">onMelt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'melt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>,
    <span class="token function-name function">onFreeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'freeze'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>,
    <span class="token function-name function">onVaporize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'vaporize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>,
    <span class="token function-name function">onCondense</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console.log<span class="token punctuation">(</span><span class="token string">'condense'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>fsm.state<span class="token punctuation">)</span><span class="token punctuation">;</span> // solid
console.log<span class="token punctuation">(</span>fsm.can<span class="token punctuation">(</span><span class="token string">'gas'</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token boolean">false</span>
console.log<span class="token punctuation">(</span>fsm.cannot<span class="token punctuation">(</span><span class="token string">'gas'</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token boolean">true</span>
console.log<span class="token punctuation">(</span>fsm.transitions<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token punctuation">[</span> <span class="token string">'melt'</span> <span class="token punctuation">]</span>

console.log<span class="token punctuation">(</span>fsm.allTransitions<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
// <span class="token punctuation">[</span> <span class="token string">'init'</span>, <span class="token string">'melt'</span>, <span class="token string">'freeze'</span>, <span class="token string">'vaporize'</span>, <span class="token string">'condense'</span> <span class="token punctuation">]</span>

console.log<span class="token punctuation">(</span>fsm.allStates<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token punctuation">[</span> <span class="token string">'none'</span>, <span class="token string">'solid'</span>, <span class="token string">'liquid'</span>, <span class="token string">'gas'</span> <span class="token punctuation">]</span>

fsm.melt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // melt
console.log<span class="token punctuation">(</span>fsm.state<span class="token punctuation">)</span><span class="token punctuation">;</span> // liquid
console.log<span class="token punctuation">(</span>fsm.transitions<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token punctuation">[</span> <span class="token string">'freeze'</span>, <span class="token string">'vaporize'</span> <span class="token punctuation">]</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>* fsm.state：当前状态；
* fsm.can：查看是否可直接转换到某个状态，参数为要转换的状态值；
* fsm.cannot：查看是否不能直接转换到某个状态，参数为要转换的状态值；
* fsm.transitions：返回可转换状态的方法列表；
* fsm.allTransitions：返回所有状态转换方法列表；
* fsm.allStates：返回定义的所有状态。
</code></pre></div><h3 id="javascript-state-machine-原理"><a href="#javascript-state-machine-原理" class="header-anchor">#</a> javascript-state-machine 原理</h3> <p>根据 javascript-state-machine 的用法我们模拟实现最基本的逻辑，构建一个有限状态机，代码如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>class StateMachine <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const <span class="token punctuation">{</span>
      init <span class="token operator">=</span> <span class="token string">'none'</span>,
      transitions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
      methods <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>

    this.state <span class="token operator">=</span> init<span class="token punctuation">;</span>

    transitions.forEach<span class="token punctuation">(</span>transition <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      const <span class="token punctuation">{</span> from, to, name <span class="token punctuation">}</span> <span class="token operator">=</span> transition<span class="token punctuation">;</span>
      this<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>this.state <span class="token operator">==</span><span class="token operator">=</span> from<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          this.state <span class="token operator">=</span> to<span class="token punctuation">;</span>
          const method <span class="token operator">=</span> <span class="token string">'on'</span> + name.slice<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">1</span><span class="token punctuation">)</span>.toUpperCase<span class="token punctuation">(</span><span class="token punctuation">)</span> + name.slice<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          methods<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> methods<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="总结-8"><a href="#总结-8" class="header-anchor">#</a> 总结</h3> <p>“状态模式” 实现的有限状态机可以更大限度的让状态变化与状态对象进行解耦，更减少了大量的判断逻辑。</p> <h2 id="_9-策略模式"><a href="#_9-策略模式" class="header-anchor">#</a> 9.策略模式</h2> <h3 id="策略模式简介"><a href="#策略模式简介" class="header-anchor">#</a> 策略模式简介</h3> <p>“策略模式” 是将定义的一组算法封装起来，使其可以相互替换，封装的算法具有一定的独立性，让算法独立于客户端而变化，可以大大减少 if...else 和 switch...case 等判断。</p> <h3 id="策略模式的实现"><a href="#策略模式的实现" class="header-anchor">#</a> 策略模式的实现</h3> <p>下面是一个关于会员打折的逻辑，根据顾客身份不同输出不同的支付金额，是未使用 “策略模式” 的实现。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 未使用策略模式 */
class Customer <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.type <span class="token operator">=</span> <span class="token builtin class-name">type</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  pay<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>this.type <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'member'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> amount * <span class="token number">0.9</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>this.type <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'vip'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> amount * <span class="token number">0.8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> amount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const c1 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const c2 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span><span class="token string">'member'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const c3 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span><span class="token string">'vip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>c1.pay<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">100</span>
console.log<span class="token punctuation">(</span>c2.pay<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">90</span>
console.log<span class="token punctuation">(</span>c3.pay<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">80</span>
</code></pre></div><p>上面的代码与 状态模式 一节中的问题类似，违反开放封闭原则和单一职责原则，代码冗余且判断条件过多，“状态模式” 虽然可以解决状态不同时不同复杂逻辑的抽离和解耦，但是并不能解决过多条件判断的问题，下面就是用 “策略模式” 来对这个点进行优化。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 使用策略模式优化 —— 策略类 */
class Customer <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this.kind <span class="token operator">=</span> kind<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  pay<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.kind.pay<span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 策略类
class Normal <span class="token punctuation">{</span>
  pay<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> amount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class Member <span class="token punctuation">{</span>
  pay<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> amount * <span class="token number">0.9</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

class VIP <span class="token punctuation">{</span>
  pay<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> amount * <span class="token number">0.8</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const c1 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span>new Normal<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
const c2 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span>new Member<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
const c3 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span>new VIP<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>c1.pay<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">100</span>
console.log<span class="token punctuation">(</span>c2.pay<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">90</span>
console.log<span class="token punctuation">(</span>c3.pay<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">80</span>
</code></pre></div><p>上面是使用策略类对复杂判断逻辑的内容进行了抽象，并将原本 if...else 中的逻辑分别放在了不同的策略类中维护，如果每一个策略类中要维护的逻辑并不是很复杂，也可以使用第二种方案，即使用策略对象维护不同的逻辑。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/* 使用策略模式优化 —— 策略对象 */
class Customer <span class="token punctuation">{</span>
  <span class="token function-name function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    // 策略对象
    this.kinds <span class="token operator">=</span> <span class="token punctuation">{</span>
      normal<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> amount<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>,
      member<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> amount * <span class="token number">0.9</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>,
      vip<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> amount * <span class="token number">0.8</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  pay<span class="token punctuation">(</span>kind, amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> this.kinds<span class="token punctuation">[</span>kind<span class="token punctuation">]</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const c1 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const c2 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const c3 <span class="token operator">=</span> new Customer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console.log<span class="token punctuation">(</span>c1.pay<span class="token punctuation">(</span><span class="token string">'normal'</span>, <span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">100</span>
console.log<span class="token punctuation">(</span>c2.pay<span class="token punctuation">(</span><span class="token string">'member'</span>, <span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">90</span>
console.log<span class="token punctuation">(</span>c3.pay<span class="token punctuation">(</span><span class="token string">'vip'</span>, <span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span> // <span class="token number">80</span>
</code></pre></div><h3 id="策略模式的应用"><a href="#策略模式的应用" class="header-anchor">#</a> 策略模式的应用</h3> <h4 id="jquery-的-animate-动画"><a href="#jquery-的-animate-动画" class="header-anchor">#</a> jQuery 的 animate 动画</h4> <p>在 jQuery 的源码实现中，animate 方法就用到了 “策略模式”，通过不同的状态定义了动画不同的行为，使用代码如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>jQuery-animate<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    <span class="token comment">#content{</span>
      width: 100px<span class="token punctuation">;</span>
      height: 100px<span class="token punctuation">;</span>
      background-color: pink<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;bigger&quot;</span><span class="token operator">&gt;</span>变大<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">&quot;http://libs.baidu.com/jquery/2.0.0/jquery.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token variable"><span class="token variable">$(</span>'<span class="token comment">#bigger'</span><span class="token variable">)</span></span>.on<span class="token punctuation">(</span><span class="token string">'click'</span>, <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token variable"><span class="token variable">$(</span>'<span class="token comment">#content'</span><span class="token variable">)</span></span>.animate<span class="token punctuation">(</span><span class="token punctuation">{</span>
        width: <span class="token string">'200px'</span>,
        height: <span class="token string">'200px'</span>
      <span class="token punctuation">}</span>, <span class="token number">1000</span>, <span class="token string">'linear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // linear 参数为动画策略的一种类型
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div><h4 id="表单校验-2"><a href="#表单校验-2" class="header-anchor">#</a> 表单校验</h4> <p>在 装饰器模式 一节中也有表单校验的应用，代码如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- 表单校验应用装饰器模式 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
  用户名：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>
  密码：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;submit-btn&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  const submitBtn <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'submit-btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  // 添加切面函数
  Function.prototype.before <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>beforeFn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const _this <span class="token operator">=</span> this<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">let</span> result <span class="token operator">=</span> beforeFn.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      result <span class="token operator">&amp;&amp;</span> _this.apply<span class="token punctuation">(</span>this, arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  // 表单提交事件
  <span class="token keyword">function</span> <span class="token function-name function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span><span class="token string">'提交表单'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  // 验证用户名
  submit <span class="token operator">=</span> submit.before<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const username <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>.value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> alert<span class="token punctuation">(</span><span class="token string">'请输入用户名'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  // 验证
  submit <span class="token operator">=</span> submit.before<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const password <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>.value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> alert<span class="token punctuation">(</span><span class="token string">'请输入密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  submitBtn.addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span>, submit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>“装饰器模式” 是将对每个表单校验逻辑，通过增加切面（AOP）的方式插入在了 submit 事件之前，如果有一个校验不通过则不会执行下一个切面的校验操作或提交表单，但是这样的表单校验有局限性，如果页面表单校验非常多需要对校验逻辑进行统一管理，并且大多数场景下是所有的表单都校验后对所有的表单进行错误提示，这是就需要 “策略模式” 的策略对象来管理所有的校验逻辑。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&lt;</span><span class="token operator">!</span>-- 表单校验应用策略模式 --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">&quot;userform&quot;</span><span class="token operator">&gt;</span>
  用户名：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>
  密码：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
  手机号：<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;mobile&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;submit&quot;</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">&quot;提交&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  const form <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'userform'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  const validator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const rules <span class="token operator">=</span> <span class="token punctuation">{</span>
      noEmpty<span class="token punctuation">(</span>val, msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token builtin class-name">return</span> msg<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>,
      minLength<span class="token punctuation">(</span>val, min, msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">||</span> val.length <span class="token operator">&lt;</span> min<span class="token punctuation">)</span> <span class="token builtin class-name">return</span> msg<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>,
      isMobile<span class="token punctuation">(</span>val, msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>/1<span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span>/.test<span class="token punctuation">(</span>val<span class="token punctuation">))</span> <span class="token builtin class-name">return</span> msg<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    // 存储
    const checks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    // 增加校验的项目
    <span class="token keyword">function</span> add<span class="token punctuation">(</span>element, rule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      checks.push<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        // <span class="token punctuation">[</span><span class="token string">'minLength'</span>, <span class="token number">6</span>, <span class="token string">'密码长度不能少于 6 位'</span><span class="token punctuation">]</span>
        const name <span class="token operator">=</span> rule.shift<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        // <span class="token punctuation">[</span>val, <span class="token number">6</span>, <span class="token string">'密码长度不能少于 6 位'</span><span class="token punctuation">]</span>
        rule.unshift<span class="token punctuation">(</span>element.value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> rules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> rules<span class="token punctuation">[</span>name<span class="token punctuation">]</span>.apply<span class="token punctuation">(</span>element, rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    // 给策略对象增加新的功能
    <span class="token keyword">function</span> addRule<span class="token punctuation">(</span>name, rule<span class="token punctuation">)</span><span class="token punctuation">{</span>
      rules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> rule<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    // 开始校验
    <span class="token keyword">function</span> <span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> checks.length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        const msg <span class="token operator">=</span> checks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token builtin class-name">return</span> msg<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token builtin class-name">return</span> <span class="token punctuation">{</span> add, addRule, start <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  // 添加自定义规则
  validator.addRule<span class="token punctuation">(</span><span class="token string">'maxLength'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>val, max, msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">||</span> val.length <span class="token operator">&gt;</span> max<span class="token punctuation">)</span> <span class="token builtin class-name">return</span> msg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  form.onsubmit <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    validator.add<span class="token punctuation">(</span>form.username, <span class="token punctuation">[</span><span class="token string">'noEmpty'</span>, <span class="token string">'用户名不能为空'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validator.add<span class="token punctuation">(</span>form.password, <span class="token punctuation">[</span><span class="token string">'minLength'</span>, <span class="token number">6</span>, <span class="token string">'密码长度不能少于 6 位'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validator.add<span class="token punctuation">(</span>form.password, <span class="token punctuation">[</span><span class="token string">'maxLength'</span>, <span class="token number">12</span>, <span class="token string">'密码长度不能大于 12 位'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validator.add<span class="token punctuation">(</span>form.mobile, <span class="token punctuation">[</span><span class="token string">'isMobile'</span>, <span class="token string">'必须输入合法的手机号'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    const msg <span class="token operator">=</span> validator.start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    alert<span class="token punctuation">(</span>msg <span class="token operator">||</span> <span class="token string">'校验通过'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token operator">!</span>msg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
</code></pre></div><p>通过对比两段代码可以显而易见的看出 “策略模式” 在对于表单校验的功能上比 “装饰器模式” 更加健壮，可以在保证可维护性的基础上支持更多复杂的功能。</p> <h3 id="总结-9"><a href="#总结-9" class="header-anchor">#</a> 总结</h3> <p>“策略模式” 和 “状态模式” 都有上下文、策略和状态类，上下文把这些请求委托给这些类来执行，“策略模式” 中，各个类是平等的，没有关系，客户端需要知道算法主动切换，“状态模式” 中，状态的切换和行为被封装好了，客户端不需要了解细节，所以 “策略模式” 真正意义的解决了状态过多时条件判断过多的问题。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_1-单例模式" class="sidebar-link reco-side-_1-单例模式" data-v-b57cc07c>1.单例模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#普通单例模式" class="sidebar-link reco-side-普通单例模式" data-v-b57cc07c>普通单例模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#透明单例模式" class="sidebar-link reco-side-透明单例模式" data-v-b57cc07c>透明单例模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#单例与构建分离" class="sidebar-link reco-side-单例与构建分离" data-v-b57cc07c>单例与构建分离</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#单例模式的应用" class="sidebar-link reco-side-单例模式的应用" data-v-b57cc07c>单例模式的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#lru-缓存" class="sidebar-link reco-side-lru-缓存" data-v-b57cc07c>LRU 缓存</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_2-发布-订阅和观察者模式" class="sidebar-link reco-side-_2-发布-订阅和观察者模式" data-v-b57cc07c>2.发布/订阅和观察者模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#发布-订阅模式" class="sidebar-link reco-side-发布-订阅模式" data-v-b57cc07c>发布/订阅模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#观察者模式" class="sidebar-link reco-side-观察者模式" data-v-b57cc07c>观察者模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#发布-订阅模式和观察者模式" class="sidebar-link reco-side-发布-订阅模式和观察者模式" data-v-b57cc07c>发布/订阅模式和观察者模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-2" class="sidebar-link reco-side-总结-2" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_3-工厂模式" class="sidebar-link reco-side-_3-工厂模式" data-v-b57cc07c>3.工厂模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#简单工厂模式" class="sidebar-link reco-side-简单工厂模式" data-v-b57cc07c>简单工厂模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#工厂方法模式" class="sidebar-link reco-side-工厂方法模式" data-v-b57cc07c>工厂方法模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#抽象工厂模式" class="sidebar-link reco-side-抽象工厂模式" data-v-b57cc07c>抽象工厂模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-3" class="sidebar-link reco-side-总结-3" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_4-适配器模式" class="sidebar-link reco-side-_4-适配器模式" data-v-b57cc07c>4.适配器模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#适配器模式的概念" class="sidebar-link reco-side-适配器模式的概念" data-v-b57cc07c>适配器模式的概念</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#适配器模式的应用" class="sidebar-link reco-side-适配器模式的应用" data-v-b57cc07c>适配器模式的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-4" class="sidebar-link reco-side-总结-4" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_5-装饰器模式" class="sidebar-link reco-side-_5-装饰器模式" data-v-b57cc07c>5.装饰器模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#装饰器模式概念" class="sidebar-link reco-side-装饰器模式概念" data-v-b57cc07c>装饰器模式概念</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#装饰器模式和适配器模式" class="sidebar-link reco-side-装饰器模式和适配器模式" data-v-b57cc07c>装饰器模式和适配器模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#装饰器模式和继承" class="sidebar-link reco-side-装饰器模式和继承" data-v-b57cc07c>装饰器模式和继承</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#装饰器模式和-aop-编程" class="sidebar-link reco-side-装饰器模式和-aop-编程" data-v-b57cc07c>装饰器模式和 AOP 编程</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#装饰器模式的应用" class="sidebar-link reco-side-装饰器模式的应用" data-v-b57cc07c>装饰器模式的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-5" class="sidebar-link reco-side-总结-5" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_6-代理模式" class="sidebar-link reco-side-_6-代理模式" data-v-b57cc07c>6.代理模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#代理模式概念" class="sidebar-link reco-side-代理模式概念" data-v-b57cc07c>代理模式概念</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#基本实现" class="sidebar-link reco-side-基本实现" data-v-b57cc07c>基本实现</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#es6-的-proxy" class="sidebar-link reco-side-es6-的-proxy" data-v-b57cc07c>ES6 的 Proxy</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#代理模式、适配器模式和装饰器模式" class="sidebar-link reco-side-代理模式、适配器模式和装饰器模式" data-v-b57cc07c>代理模式、适配器模式和装饰器模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#代理模式的应用" class="sidebar-link reco-side-代理模式的应用" data-v-b57cc07c>代理模式的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#图片加载" class="sidebar-link reco-side-图片加载" data-v-b57cc07c>图片加载</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#防抖代理" class="sidebar-link reco-side-防抖代理" data-v-b57cc07c>防抖代理</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-6" class="sidebar-link reco-side-总结-6" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_7-外观模式" class="sidebar-link reco-side-_7-外观模式" data-v-b57cc07c>7.外观模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#外观模式简介" class="sidebar-link reco-side-外观模式简介" data-v-b57cc07c>外观模式简介</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#外观模式的实现" class="sidebar-link reco-side-外观模式的实现" data-v-b57cc07c>外观模式的实现</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-7" class="sidebar-link reco-side-总结-7" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_8-状态模式" class="sidebar-link reco-side-_8-状态模式" data-v-b57cc07c>8.状态模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#状态模式简介" class="sidebar-link reco-side-状态模式简介" data-v-b57cc07c>状态模式简介</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#状态模式的实现" class="sidebar-link reco-side-状态模式的实现" data-v-b57cc07c>状态模式的实现</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#状态模式的应用" class="sidebar-link reco-side-状态模式的应用" data-v-b57cc07c>状态模式的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#react-组件显示隐藏" class="sidebar-link reco-side-react-组件显示隐藏" data-v-b57cc07c>React 组件显示隐藏</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#有限状态机" class="sidebar-link reco-side-有限状态机" data-v-b57cc07c>有限状态机</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#javascript-state-machine-使用" class="sidebar-link reco-side-javascript-state-machine-使用" data-v-b57cc07c>javascript-state-machine 使用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#javascript-state-machine-原理" class="sidebar-link reco-side-javascript-state-machine-原理" data-v-b57cc07c>javascript-state-machine 原理</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-8" class="sidebar-link reco-side-总结-8" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#_9-策略模式" class="sidebar-link reco-side-_9-策略模式" data-v-b57cc07c>9.策略模式</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#策略模式简介" class="sidebar-link reco-side-策略模式简介" data-v-b57cc07c>策略模式简介</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#策略模式的实现" class="sidebar-link reco-side-策略模式的实现" data-v-b57cc07c>策略模式的实现</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#策略模式的应用" class="sidebar-link reco-side-策略模式的应用" data-v-b57cc07c>策略模式的应用</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/blogs/js-design-patterns.html#总结-9" class="sidebar-link reco-side-总结-9" data-v-b57cc07c>总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:-1;" data-v-248d85d6></canvas></div><canvas id="vuepress-canvas-cursor"></canvas><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://cs-sycdn.kuwo.cn/371642c104355a522300695af11424d3/64db8722/resource/n3/6/44/3638605905.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:20px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://img1.kuwo.cn/star/albumcover/500/53/43/1728161476.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://img1.kuwo.cn/star/albumcover/500/53/43/1728161476.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>可能</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>程响</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/vuepress-blog/assets/js/app.cfe4f1dc.js" defer></script><script src="/vuepress-blog/assets/js/7.a84a24ff.js" defer></script><script src="/vuepress-blog/assets/js/2.c3a99807.js" defer></script><script src="/vuepress-blog/assets/js/1.c178cf32.js" defer></script><script src="/vuepress-blog/assets/js/55.84021d4c.js" defer></script>
  </body>
</html>
